#pragma once

#include <functional>
#include <memory>
#include <lua.h>
#include <thread>

struct DebuggerResult
{
    uint32_t result;
    uint32_t unk[4];
};

struct WeakThreadRef
{
    std::atomic<uint32_t> refs;
    lua_State* L;
    uint32_t thread_ref;
    uint32_t object_id;
    uint32_t unk1;
    uint32_t unk2;

    WeakThreadRef(lua_State* L) : refs(0), L(L), thread_ref(0), object_id(0), unk1(0), unk2(0) {}
};

using yielded = std::function<int(lua_State*)>;
namespace yielding
{
    int yield_execution(lua_State* L, const std::function<yielded()>& function);
    void run_yield();
}
